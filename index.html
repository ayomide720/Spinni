<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Advanced Spin Game</title>
<style>
  body {
    background: #f0f2f5;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    padding: 30px;
    min-height: 100vh;
    margin: 0;
    gap: 30px;
  }
  main {
    flex: 1;
    max-width: 600px;
  }
  h1 {
    margin-bottom: 10px;
  }
  button {
    padding: 12px 30px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    background-color: #111;
    color: white;
    cursor: pointer;
    margin: 10px 10px 10px 0;
  }
  #result, #stats, #money, #gears {
    margin-top: 20px;
    width: 100%;
    padding: 15px 20px;
    border-radius: 12px;
    background: white;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
    font-size: 16px;
    text-align: center;
  }
  /* Rarity Colors */
  .rarity-Common        { color: #666; }
  .rarity-Uncommon      { color: #2ecc71; }
  .rarity-Rare          { color: #3498db; }
  .rarity-Epic          { color: #9b59b6; }
  .rarity-Legendary     { color: #f1c40f; }
  .rarity-Mythic        { color: #e67e22; }
  .rarity-Ancient       { color: #d35400; }
  .rarity-Celestial     { color: #1abc9c; }
  .rarity-Transcendent  { color: #e91e63; }
  .rarity-Omniversal    { color: #ff0000; font-weight: bold; }
  .rarity-Divine        { color: gold; }
  .rarity-Phantom       { color: slateblue; }
  .rarity-Quantum       { color: darkcyan; }
  .rarity-Astral        { color: mediumorchid; }
  .rarity-Glitched      { color: darkred; }
  .variant {
    font-style: italic;
    margin-left: 5px;
    padding: 2px 6px;
    border-radius: 5px;
    background: #eee;
    font-weight: 600;
    user-select: none;
  }
  /* Sidebar dropdown styling */
  #sidebar {
    width: 250px;
    background: white;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  label {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
  }
  select {
    width: 100%;
    font-size: 16px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin-bottom: 15px;
    cursor: pointer;
  }
</style>
</head>
<body>

<main>
  <h1>ðŸŽ° Advanced Spin Game</h1>
  <button id="spin-btn">Spin</button>
  <button id="auto-spin-btn" disabled>Auto Spin: OFF</button>

  <div id="result">Your result will appear here.</div>
  <div id="money">Money: 0</div>
  <div id="stats">Total Spins: 0<br>Rarest Pull: N/A</div>
  <div id="gears">
    <h3>Gear Status</h3>
    <div id="gear-list">No gears collected yet.</div>
  </div>
</main>

<div id="sidebar">
  <label for="rarity-list">All Rarities</label>
  <select id="rarity-list" size="16" readonly>
    <!-- Options populated by JS -->
  </select>
</div>

<script>
  // Rarity weights: lower number = rarer
  const rarities = {
    "Common": 10000,
    "Uncommon": 5000,
    "Rare": 2000,
    "Epic": 1000,
    "Legendary": 500,
    "Mythic": 200,
    "Ancient": 100,
    "Celestial": 50,
    "Transcendent": 10,
    "Omniversal": 1,
    "Divine": 5,
    "Phantom": 25,
    "Quantum": 15,
    "Astral": 8,
    "Glitched": 3
  };

  // Variants with weights per rarity
  const variants = {
    "Common": [
      {name:"Rusty", weight: 40},
      {name:"Dusty", weight: 30},
      {name:"Basic", weight: 50},
      {name:"Worn", weight: 20},
      {name:"Scratched", weight: 10}
    ],
    "Uncommon": [
      {name:"Polished", weight: 50},
      {name:"Light-Tinted", weight: 25},
      {name:"Improved", weight: 20},
      {name:"Fine", weight: 15},
      {name:"Refined", weight: 10}
    ],
    "Rare": [
      {name:"Shiny", weight: 35},
      {name:"Steel-Plated", weight: 25},
      {name:"Neat", weight: 20},
      {name:"Glow-Edge", weight: 15},
      {name:"Sharp", weight: 10}
    ],
    "Epic": [
      {name:"Crimson", weight: 30},
      {name:"Shadow-Forged", weight: 20},
      {name:"Holy", weight: 15},
      {name:"Void-Touched", weight: 10},
      {name:"Spiked", weight: 5}
    ],
    "Legendary": [
      {name:"Dragoncore", weight: 25},
      {name:"Arcane-Blade", weight: 20},
      {name:"Royal", weight: 15},
      {name:"Phoenix", weight: 10},
      {name:"Duskborne", weight: 5}
    ],
    "Mythic": [
      {name:"Ethereal", weight: 20},
      {name:"Twilightborn", weight: 15},
      {name:"Spiritforged", weight: 10},
      {name:"Hellfire", weight: 7},
      {name:"Radiant", weight: 3}
    ],
    "Ancient": [
      {name:"Relic-Bound", weight: 20},
      {name:"Time-Worn", weight: 15},
      {name:"Forgotten", weight: 10},
      {name:"Runic", weight: 8},
      {name:"Ruined", weight: 5}
    ],
    "Celestial": [
      {name:"Starforged", weight: 15},
      {name:"Void-Dancer", weight: 10},
      {name:"Cometfall", weight: 8},
      {name:"Skylit", weight: 5},
      {name:"Galaxian", weight: 3}
    ],
    "Transcendent": [
      {name:"God-Touched", weight: 12},
      {name:"Echoed Soul", weight: 8},
      {name:"Lightbane", weight: 6},
      {name:"Fate-Warped", weight: 4},
      {name:"Dimensional", weight: 2}
    ],
    "Omniversal": [
      {name:"Origin", weight: 8},
      {name:"True Form", weight: 5},
      {name:"Undefined", weight: 4},
      {name:"Nullborn", weight: 2},
      {name:"Singularity", weight: 1}
    ],
    "Divine": [
      {name:"Purelight", weight: 10},
      {name:"Heaven's Kiss", weight: 7},
      {name:"Blessed", weight: 5},
      {name:"Immortal", weight: 3},
      {name:"Sacred", weight: 1}
    ],
    "Phantom": [
      {name:"Ghostblade", weight: 10},
      {name:"Wraith-Edge", weight: 7},
      {name:"Spectral", weight: 5},
      {name:"Eclipsed", weight: 3},
      {name:"Soulshadow", weight: 1}
    ],
    "Quantum": [
      {name:"Entangled", weight: 10},
      {name:"Chrono-Shard", weight: 7},
      {name:"Qbit Field", weight: 5},
      {name:"Wavecut", weight: 3},
      {name:"Collapse", weight: 1}
    ],
    "Astral": [
      {name:"Nebulite", weight: 10},
      {name:"Gravity Flare", weight: 7},
      {name:"Starseeker", weight: 5},
      {name:"Orbitburn", weight: 3},
      {name:"Pulseflow", weight: 1}
    ],
    "Glitched": [
      {name:"Corruptbyte", weight: 12},
      {name:"ERROR-001", weight: 8},
      {name:"Dataleak", weight: 6},
      {name:"Crashcode", weight: 4},
      {name:"Fractured", weight: 2}
    ],
  };

  const moneyBase = {
    "Common": 1,
    "Uncommon": 3,
    "Rare": 7,
    "Epic": 15,
    "Legendary": 30,
    "Mythic": 60,
    "Ancient": 100,
    "Celestial": 150,
    "Transcendent": 300,
    "Omniversal": 500,
    "Divine": 450,
    "Phantom": 400,
    "Quantum": 350,
    "Astral": 320,
    "Glitched": 600,
  };

  // GEARS + CHANGES:
  const gears = [
    {
      name: "Dragonfang Sword",
      // Make requirements 12x harder (multiply counts required by 12)
      requirements: {
        "Legendary": ["Dragoncore", "Phoenix"],
        "Epic": ["Holy"]
      },
      multiplier: 12 // We'll use this to multiply requirements check counts
    },
    {
      name: "Voidwalker Armor",
      requirements: {
        "Glitched": ["Dataleak"],
        "Transcendent": ["Fate-Warped"]
      },
      rarityLuckMultiplier: 1.5 // Boost rarity roll by 1.5x when owned
    },
    {
      name: "Celestial Bow",
      requirements: {
        "Celestial": ["Starforged", "Galaxian"],
        "Rare": ["Shiny"]
      }
    }
  ];

  let inventory = {};
  let totalSpins = 0;
  let rarestWeight = Infinity;
  let rarestFull = null;
  let totalMoney = 0;

  let autoSpinActive = false;
  let autoSpinInterval = null;

  // Track if player has gear affecting rarity luck
  let rarityLuckMultiplier = 1;

  // Helper: weighted random from array [{name,weight}]
  function weightedRandom(items) {
    const totalWeight = items.reduce((acc, i) => acc + i.weight, 0);
    let rand = Math.random() * totalWeight;
    for (const item of items) {
      if (rand < item.weight) return item.name;
      rand -= item.weight;
    }
    return items[0].name;
  }

  // Weighted rarity with gear multiplier applied
  function getWeightedRarity(weightMap) {
    const entries = Object.entries(weightMap);

    // Find max weight normally
    const maxWeight = Math.max(...entries.map(([, w]) => w));

    // Apply multiplier ONLY to rarities the player has the Voidwalker Armor gear for
    // This means rarities are weighted to be more likely rarer.
    // We'll invert the weights and multiply the inverse by rarityLuckMultiplier
    const invWeights = entries.map(([key, w]) => {
      const inv = maxWeight - w + 1;
      return [key, inv * rarityLuckMultiplier];
    });

    const total = invWeights.reduce((sum, [, w]) => sum + w, 0);
    let rand = Math.random() * total;
    for (const [key, w] of invWeights) {
      if (rand < w) return key;
      rand -= w;
    }
    return "Common";
  }

  // Adjust variant count chance to make variants rarer
  function getNumVariants() {
    const roll = Math.random();
    if (roll < 0.97) return 0;  // 97% chance no variant at all
    else if (roll < 0.995) return 1; // 2.5% chance 1 variant
    else return 2; // 0.5% chance 2 variants
  }

  // The spin function
  function spin() {
    totalSpins++;

    const rarity = getWeightedRarity(rarities);
    const variantPool = variants[rarity] || [];
    const numVariants = getNumVariants();

    // Pick unique variants weighted
    const chosenVariants = [];
    const copyPool = [...variantPool];
    for (let i = 0; i < numVariants && copyPool.length > 0; i++) {
      const chosen = weightedRandom(copyPool);
      chosenVariants.push(chosen);
      // Remove chosen variant from pool
      const idx = copyPool.findIndex(v => v.name === chosen);
      if (idx !== -1) copyPool.splice(idx, 1);
    }

    // Compose full name
    let fullName = rarity;
    if (chosenVariants.length > 0) {
      fullName += " " + chosenVariants.map(v => `<span class="variant">${v}</span>`).join(", ");
    }

    // Calculate money reward
    let moneyReward = moneyBase[rarity] || 1;
    moneyReward = Math.round(moneyReward * (1 + chosenVariants.length * 0.1));

    // Update inventory
    if (!inventory[rarity]) inventory[rarity] = {};
    if (chosenVariants.length === 0) {
      inventory[rarity]["_none"] = (inventory[rarity]["_none"] || 0) + 1;
    } else {
      chosenVariants.forEach(v => {
        inventory[rarity][v] = (inventory[rarity][v] || 0) + 1;
      });
    }

    // Track rarest
    const rarityWeight = rarities[rarity];
    if (rarityWeight < rarestWeight) {
      rarestWeight = rarityWeight;
      rarestFull = fullName;
    }

    // Update totals and UI
    totalMoney += moneyReward;
    updateUI(fullName, rarity, rarityWeight, moneyReward);
    updateGearStatus();
  }

  function updateUI(fullName, rarity, rarityWeight, moneyReward) {
    document.getElementById("result").innerHTML = `
      You got:<br><br>
      <span class="rarity-${rarity}">${fullName}</span><br><br>
      <small>(1 in ${Math.floor(10000 / rarityWeight)} odds)<br>
      Money gained: ${moneyReward}</small>
    `;

    document.getElementById("stats").innerHTML = `
      Total Spins: ${totalSpins}<br>
      Rarest Pull: <span class="rarity-${rarity}">${rarestFull || "N/A"}</span>
    `;

    document.getElementById("money").textContent = `Money: ${totalMoney}`;
  }

  function updateGearStatus() {
    const gearListBox = document.getElementById("gear-list");
    let unlockedAutoSpin = false;
    rarityLuckMultiplier = 1; // Reset

    const gearHtml = gears.map(gear => {
      const reqs = gear.requirements;
      let metAll = true;
      let reqStrings = [];

      // We'll make a multiplier for first gear to multiply counts needed
      const mult = gear.multiplier || 1;

      for (const [reqRarity, reqVariants] of Object.entries(reqs)) {
        if (!inventory[reqRarity]) {
          metAll = false;
          reqStrings.push(`<b class="rarity-${reqRarity}">${reqRarity}</b>: missing`);
          continue;
        }
        for (const reqVar of reqVariants) {
          const hasCount = inventory[reqRarity][reqVar] || 0;
          // Multiply required count by gear.multiplier (default 1)
          if (hasCount < 1 * mult) {
            metAll = false;
            reqStrings.push(`<b class="rarity-${reqRarity}">${reqRarity}</b> <span class="variant">${reqVar}</span>: missing`);
          } else {
            reqStrings.push(`<b class="rarity-${reqRarity}">${reqRarity}</b> <span class="variant">${reqVar}</span>: âœ“`);
          }
        }
      }

      if (metAll && gear.name === "Dragonfang Sword") {
        unlockedAutoSpin = true;
      }

      if (metAll && gear.rarityLuckMultiplier) {
        rarityLuckMultiplier = gear.rarityLuckMultiplier;
      }

      const status = metAll
        ? `<span style="color:green; font-weight:bold;">Collected!</span>`
        : `<span style="color:red;">Incomplete</span>`;

      return `<div style="margin-bottom:12px;">
        <strong>${gear.name}</strong> â€” ${status}<br>
        Requirements:<br> ${reqStrings.join("<br>")}
      </div>`;
    }).join("");

    gearListBox.innerHTML = gearHtml;

    // Enable/disable auto-spin button
    const autoSpinBtn = document.getElementById("auto-spin-btn");
    if (unlockedAutoSpin) {
      autoSpinBtn.disabled = false;
    } else {
      autoSpinBtn.disabled = true;
      if (autoSpinActive) toggleAutoSpin(); // turn off if gear lost
    }
  }

  // Toggle auto-spin function
  function toggleAutoSpin() {
    const autoSpinBtn = document.getElementById("auto-spin-btn");
    if (!autoSpinActive) {
      autoSpinActive = true;
      autoSpinBtn.textContent = "Auto Spin: ON";
      autoSpinInterval = setInterval(spin, 2000);
    } else {
      autoSpinActive = false;
      autoSpinBtn.textContent = "Auto Spin: OFF";
      clearInterval(autoSpinInterval);
    }
  }

  // Populate the dropdown with rarities
  function populateRarityList() {
    const rarityList = document.getElementById("rarity-list");
    const sorted = Object.entries(rarities)
      .sort((a, b) => a[1] - b[1]); // sort from rarest to most common
    sorted.forEach(([rarity]) => {
      const option = document.createElement("option");
      option.textContent = rarity;
      option.className = "rarity-" + rarity;
      rarityList.appendChild(option);
    });
  }

  // Setup event listeners after DOM ready
  window.addEventListener("DOMContentLoaded", () => {
    const spinBtn = document.getElementById("spin-btn");
    const autoSpinBtn = document.getElementById("auto-spin-btn");

    spinBtn.addEventListener("click", spin);
    autoSpinBtn.addEventListener("click", toggleAutoSpin);

    updateGearStatus();
    populateRarityList(); // <- call to populate rarity dropdown
  });
</script>

</body>
</html>